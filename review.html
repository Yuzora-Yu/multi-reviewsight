<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>だれでもレビュー｜レビュー詳細</title>

  <base href="/multi-reviewsight/">

  <!-- Tailwind（必要なら） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase SDK -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- テーマCSS -->
  <link rel="stylesheet" href="css/style.css?v=2025-10-03" />

  <!-- 共通JS（先に読み込む） -->
  <script defer src="js/common.js?v=2025-10-03"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="border-b bg-white">
    <div class="mx mx-auto flex items-center justify-between" style="padding: 12px 20px;">
      <a class="brand" href="index.html">だれでもレビュー</a>
      <nav id="navRight" class="flex items-center gap-2">
        <a id="myLink" class="btn nav-mypage" href="my.html">マイページ</a>
        <!-- 管理ボタンは JS でマイページとログインの間に挿入 -->
        <a id="loginLink" class="btn-outline" href="auth.html">ログイン / 登録</a>
      </nav>
    </div>
  </header>

  <main class="mx">
    <section class="block">
      <div class="flex items-start gap-4">
        <div class="mediaBox lg" id="detailThumbBox">
          <img id="detailThumb" src="https://placehold.co/256x256?text=Loading" alt="" data-fit="auto">
        </div>
        <div class="flex-1">
          <h1 class="title" id="detailTitle">タイトル読み込み中</h1>
          <p class="meta" id="detailMeta">ジャンル / レビュアー名 / 日付</p>
          <div class="meta" id="detailScore">スコア: -</div>
        </div>
      </div>

      <article id="detailBody" class="mt-4 review-box">本文読み込み中…</article>
    </section>
  </main>

  <footer class="py-10 text-center text-sm text-gray-500">© 2025 だれでもレビュー</footer>

  <!-- 詳細ページ用の読み込みJS（fitThumbs 呼び出し含む） -->
  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Supabase クライアントは common.js 側で window.sb として生成済み想定
    const sb = window.sb;
    const id = new URLSearchParams(location.search).get('id');

    try {
      const { data: r, error } = await sb
        .from('reviews')
        .select('*')
        .eq('id', id)
        .maybeSingle();
      if (error || !r) throw error || new Error('not found');

      // タイトル等
      document.getElementById('detailTitle').textContent = r.title;
      document.getElementById('detailMeta').textContent =
        `${r.genre} / ${r.author_name || '匿名'} / ${new Date(r.created_at).toLocaleDateString()}`;
      document.getElementById('detailScore').textContent = `スコア: ${r.score}`;

      // 画像
      const imgEl = document.getElementById('detailThumb');
      imgEl.src = r.product_image_url || 'https://placehold.co/256x256?text=No+Image';
      window.fitThumbs(document.getElementById('detailThumbBox'));

      // 本文（プレーンテキストを想定。HTMLなら innerHTML に切替）
      document.getElementById('detailBody').textContent = r.body || '';
    } catch (e) {
      console.error(e);
      document.getElementById('detailBody').textContent = '読み込みに失敗しました';
    }
  });
  </script>
</body>
</html>
