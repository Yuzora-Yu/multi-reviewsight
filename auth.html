<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>だれでもレビュー｜ログイン / 会員登録</title>
  <base href="/multi-reviewsight/">

  <link rel="stylesheet" href="css/style.css?v=2025-10-04" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="js/common.js?v=2025-10-04"></script>
  <script defer src="js/auth.js?v=2025-10-04"></script>
</head>
<body class="bg-gray-50 text-gray-900" data-page="auth">
  <header class="border-b bg-white">
    <div class="mx mx-auto flex items-center justify-between" style="padding: 12px 20px;">
      <a class="brand" href="./">だれでもレビュー</a>
      <nav id="navRight" class="flex items-center gap-2">
        <a id="myLink" class="btn nav-mypage" href="my.html">マイページ</a>
        <a id="loginLink" class="btn-outline" href="auth.html">ログイン / 登録</a>
      </nav>
    </div>
  </header>

  <main class="mx mx-auto space-y-6" style="max-width: 720px;">
    <section class="block">
      <h1 class="title mb-2">ログイン / 会員登録</h1>
      <p class="meta">メールでのログイン/登録に対応しています。</p>

      <div class="mt-4 flex flex-wrap gap-3">
        <button class="btn" onclick="window.openModal('#modalLogin')">ログイン</button>
        <button class="btn-outline" onclick="window.openModal('#modalRegister')">新規会員登録</button>
        <button id="logoutBtn" class="btn-outline hidden">ログアウト</button>
      </div>

      <div class="mt-4">
        <strong>現在の状態：</strong> <span id="authState">読み込み中…</span>
      </div>
    </section>

    <section class="block">
      <h2 class="title">メールの流れ（登録）</h2>
      <ol class="list-decimal pl-6 space-y-1 text-sm text-gray-600">
        <li>「新規会員登録」→ メール/パスワード/確認用パスワード を入力して <b>仮登録</b></li>
        <li>自動送信されたメールのリンクを押す</li>
        <li>このページに戻り、表示されたメールを確認 → <b>レビュアーネーム</b> を入力して <b>本登録</b></li>
      </ol>
    </section>
  </main>

  <!-- トースト表示（右下） -->
  <div id="toastWrap" class="toast-wrap"></div>

  <!-- Modal: ログイン -->
  <div id="modalLogin" class="modal hidden" aria-hidden="true">
    <div class="overlay"></div>
    <div class="panel">
      <div class="flex items-center justify-between mb-3">
        <h3 class="title">ログイン</h3>
        <button class="btn-ghost" data-close="#modalLogin">閉じる</button>
      </div>
      <form id="loginForm" class="space-y-3">
        <input id="loginEmail" class="inp" type="email" placeholder="メールアドレス" required />
        <input id="loginPass" class="inp" type="password" placeholder="パスワード" required />
        <button class="btn w-full" type="submit">ログイン</button>
      </form>
      <p class="meta mt-3">※ パスワードを忘れた場合は再登録してください。</p>
    </div>
  </div>

  <!-- Modal: 新規登録（仮登録） -->
  <div id="modalRegister" class="modal hidden" aria-hidden="true">
    <div class="overlay"></div>
    <div class="panel">
      <div class="flex items-center justify-between mb-3">
        <h3 class="title">新規会員登録（仮登録）</h3>
        <button class="btn-ghost" data-close="#modalRegister">閉じる</button>
      </div>
      <form id="registerForm" class="space-y-3">
        <input id="regEmail" class="inp" type="email" placeholder="メールアドレス" required />
        <input id="regPass" class="inp" type="password" placeholder="パスワード（8文字以上）" minlength="8" required />
        <input id="regPass2" class="inp" type="password" placeholder="確認用パスワード" minlength="8" required />
        <button class="btn w-full" type="submit">仮登録メールを送信</button>
      </form>
      <p class="meta mt-3">※ 入力したアドレス宛に確認メールが届きます。</p>
    </div>
  </div>

  <!-- Modal: レビュアーネーム（本登録） -->
  <div id="modalName" class="modal hidden" aria-hidden="true">
    <div class="overlay"></div>
    <div class="panel">
      <div class="flex items-center justify-between mb-3">
        <h3 class="title">本登録：レビュアーネーム</h3>
        <button class="btn-ghost" data-close="#modalName">閉じる</button>
      </div>
      <p class="mb-2 text-sm">メール：<span id="nameEmail" class="font-mono"></span></p>
      <form id="nameForm" class="space-y-3">
        <input id="displayName" class="inp" maxlength="30" placeholder="表示する名前（レビュアーネーム）" required />
        <button class="btn w-full" type="submit">本登録する</button>
      </form>
    </div>
  </div>
</body>
</html>
