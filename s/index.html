<!doctype html>
<html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>短縮URL - だれでもレビュー</title>
<base href="/multi-reviewsight/">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script defer src="../js/common.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  // /multi-reviewsight/s/<sid> の <sid> を取り出す
  const parts = location.pathname.split('/');
  const sid = parts[parts.indexOf('s') + 1] || '';
  if (!sid) { location.href = './'; return; }

  // sid → id を引いてリダイレクト
  try {
    const { data, error } = await window.supabase
      .from('reviews').select('id').eq('short_id', sid).single();
    if (error || !data) throw error;
    location.replace(`../review.html?id=${data.id}`);
  } catch {
    document.body.innerHTML = '<p>リンクが無効です。</p>';
  }
});
</script>
</head><body></body></html>
